{% extends "_base.html" %}
{% block content %}
{% set pill_classes = {
  "TOPUP": "tx-pill tx-pill-topup",
  "DEBIT": "tx-pill tx-pill-debit",
  "REFUND": "tx-pill tx-pill-refund",
  "ADJUST": "tx-pill tx-pill-adjust"
} %}
<div class="row g-3">
  <div class="col-md-4">
    <div class="card p-3 text-bg-light">
      <div class="fs-5">Today (local)</div>
      <div>Top‑ups: <strong>¥{{ (totals.topups or 0) }}</strong></div>
      <div>Sales: <strong>¥{{ (totals.sales or 0) }}</strong></div>
    </div>
  </div>
</div>

<h5 class="mt-4">Recent activity</h5>
<div class="table-responsive">
<table class="table table-sm align-middle">
  <thead><tr><th>Time (UTC+8)</th><th>Name</th><th>Type</th><th class="text-end">Amount</th><th>Overpay</th></tr></thead>
  <tbody>
    {% for r in tx %}
    <tr>
      <td>{{ r.created_at|fmt_ts }}</td>
      <td>{{ r.name }}</td>
      <td><span class="{{ pill_classes.get(r.type, 'tx-pill tx-pill-default') }}">{{ r.type }}</span></td>
      <td class="text-end">
        {% if r.amount < 0 %}
          <span class="amount-neg">-¥{{ -r.amount }}</span>
        {% else %}
          <span class="amount-pos">¥{{ r.amount }}</span>
        {% endif %}
      </td>
      <td>{% if r.overdraft_component %}¥{{ r.overdraft_component }}{% else %}—{% endif %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
